(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{538:function(s,e,a){"use strict";a.r(e);var r=a(30),n=Object(r.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),a("p",[s._v("这篇文章，主要记录我如何在本地环境搭建redis集群的过程。")]),s._v(" "),a("h3",{attrs:{id:"前提"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前提"}},[s._v("#")]),s._v(" 前提")]),s._v(" "),a("ul",[a("li",[s._v("本地已安装docker")]),s._v(" "),a("li",[s._v("本地机器（Linux） ps：我本地环境为Mac")])]),s._v(" "),a("h3",{attrs:{id:"过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#过程"}},[s._v("#")]),s._v(" 过程")]),s._v(" "),a("ol",[a("li",[s._v("拉取docker redis镜像")])]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker pull redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("2.确认redis镜像是否拉取成功")]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker images\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("3.新建redis模版配置文件\n在本地机器中，新建一个配置文件。我推荐，先创建/Users/username/redis 文件夹，然后在文件夹中新建redis-cluster.conf 文件，写入如下内容。")]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# ${PORT} redis 端口号。下一步，使用脚本替换。\nport ${PORT}\ncluster-enabled yes\nprotected-mode no\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\n#外部ip，可以使用ifconfig命令查看。 [注意: 不是127.0.0.1]\ncluster-announce-ip 192.168.0.12\ncluster-announce-port ${PORT}\ncluster-announce-bus-port 1${PORT}\nappendonly yes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("创建文件命令")]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir -p /Users/username/redis\n\ntouch /Users/username/redis/redis-cluster.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("4.在/Users/username/redis 目录下，执行如下脚本文件，批量生成redis配置文件和data目录。")]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("for port in `seq 6000 6005`; do \n  mkdir -p ./${port}/conf && PORT=${port} envsubst < ./redis-cluster.conf > ./${port}/conf/redis.conf && mkdir -p ./${port}/data;\ndone\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("5.执行docker启动脚本，执行成功后，通过docker ps 命令查看，如果新增6个容器，则代表成功。")]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("for port in `seq 6000 6005`; do \n  docker run -d -ti -p ${port}:${port} -p 1${port}:1${port} -v /Users/username/redis/${port}/conf/redis.conf:/usr/local/etc/redis/redis.conf -v /Users/username/redis/${port}/data:/data  --restart always --name redis-${port} --net redis-net --sysctl net.core.somaxconn=1024 redis redis-server /usr/local/etc/redis/redis.conf; \ndone\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("6.进入某一个容器，进行关联。3主3从。")]),s._v(" "),a("p",[s._v("进入容器命令")]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it containerid /bin/sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("执行关联")]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /usr/local/bin && redis-cli --cluster create 192.168.0.12:6000 192.168.0.12:6001 192.168.0.12:6002 192.168.0.12:6003 192.168.0.12:6004 ip:6005 --cluster-replicas 1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("7.使用redis-cli 链接其中一个redis，增加一条数据。然后通过其它redis 容器，验证是否关联成功，")]),s._v(" "),a("div",{staticClass:"language-s line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("redis-cli -c -h 192.168.0.12 -p 6000 set test 1\n\nredis-cli -c -h 192.168.0.12 -p 6001 get test\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);